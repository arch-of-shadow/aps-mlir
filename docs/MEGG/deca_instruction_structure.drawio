<mxfile host="app.diagrams.net">
  <diagram name="DECA Instruction">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="700">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="DECA 解压缩指令 (2-bit → INT8)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="600" height="40" as="geometry"/>
        </mxCell>

        <!-- Phase 1: Burst Read -->
        <mxCell id="phase1_box" value="Phase 1: Burst Read" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="100" width="300" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="phase1_content" value="从内存批量加载到Scratchpad:&#xa;&#xa;• bitmap_buf[32]  ← burst_read 32B&#xa;• packed_buf[64]  ← burst_read 64B" style="text;html=1;align=left;verticalAlign=middle;fontSize=12;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="120" y="135" width="260" height="70" as="geometry"/>
        </mxCell>

        <!-- Phase 2: Decompress Loop -->
        <mxCell id="phase2_box" value="Phase 2: 本地解压 (256次迭代)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="260" width="300" height="240" as="geometry"/>
        </mxCell>
        <mxCell id="phase2_content" value="for i in 0..256:&#xa;&#xa;  ① 读bitmap bit:&#xa;     bit = bitmap_buf[i&gt;&gt;3][i&amp;7]&#xa;&#xa;  ② if bit == 1:&#xa;       读packed 2-bit数据&#xa;       LUT查表: 2bit → INT8&#xa;          00→0, 01→1, 10→-1, 11→-1&#xa;     else:&#xa;       输出0&#xa;&#xa;  ③ 写入: output_buf[i] = value" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="120" y="295" width="260" height="190" as="geometry"/>
        </mxCell>

        <!-- Phase 3: Burst Write -->
        <mxCell id="phase3_box" value="Phase 3: Burst Write" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="540" width="300" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="phase3_content" value="批量写回内存:&#xa;&#xa;• burst_write 256B → memory&#xa;• 返回非零计数: rd ← nz_cnt" style="text;html=1;align=left;verticalAlign=middle;fontSize=12;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="120" y="575" width="260" height="55" as="geometry"/>
        </mxCell>

        <!-- Arrows -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#6c8ebf;endArrow=block;endFill=1;" edge="1" parent="1" source="phase1_box" target="phase2_box">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#d79b00;endArrow=block;endFill=1;" edge="1" parent="1" source="phase2_box" target="phase3_box">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Right side: Key Features -->
        <mxCell id="features_box" value="关键特性" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="500" y="100" width="600" height="270" as="geometry"/>
        </mxCell>

        <mxCell id="feat1_title" value="✓ Burst I/O (核心优化)" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="520" y="130" width="250" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="feat1_detail" value="  传统: ~576次内存访问&#xa;  Burst: 3次批量传输&#xa;  加速: 100-200x 内存带宽" style="text;html=1;align=left;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="520" y="155" width="250" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="feat2_title" value="✓ 本地Scratchpad" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="520" y="215" width="250" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="feat2_detail" value="  bitmap_buf[32], packed_buf[64]&#xa;  output_buf[256]&#xa;  低延迟访问 (1-2周期)" style="text;html=1;align=left;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="520" y="240" width="250" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="feat3_title" value="✓ LUT查表 (2-bit → INT8)" style="text;html=1;align=left;fontSize=13;fontStyle=1;fontColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="520" y="300" width="250" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="feat3_detail" value="  lut[4] = {0, 1, -1, -1}&#xa;  寄存器/ROM实现&#xa;  零延迟查表" style="text;html=1;align=left;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="520" y="325" width="250" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="feat4_title" value="✓ 固定Tile Size (256)" style="text;html=1;align=left;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="130" width="250" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="feat4_detail" value="  编译时常量&#xa;  消除动态检查&#xa;  循环优化机会" style="text;html=1;align=left;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="820" y="155" width="250" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="feat5_title" value="✓ 精确位宽类型" style="text;html=1;align=left;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="215" width="250" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="feat5_detail" value="  u3 (bit索引), u6 (循环计数)&#xa;  u2 (2-bit数据), i8 (输出)&#xa;  硬件资源节约50-90%" style="text;html=1;align=left;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="820" y="240" width="250" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="feat6_title" value="✓ 稀疏感知" style="text;html=1;align=left;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="300" width="250" height="25" as="geometry"/>
        </mxCell>
        <mxCell id="feat6_detail" value="  bitmap标记非零位置&#xa;  只解压非零元素&#xa;  返回非零计数" style="text;html=1;align=left;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="820" y="325" width="250" height="50" as="geometry"/>
        </mxCell>

        <!-- Performance Summary -->
        <mxCell id="perf_box" value="性能估计" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="500" y="400" width="600" height="120" as="geometry"/>
        </mxCell>

        <mxCell id="perf_content" value="内存访问: 3次descriptor读取 + 2次burst read + 1次burst write = 6次&#xa;&#xa;计算延迟: ~500-1000 周期 (256次迭代 + burst开销)&#xa;&#xa;总加速比: 200-400x vs 纯CPU实现" style="text;html=1;align=left;verticalAlign=middle;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="520" y="435" width="560" height="70" as="geometry"/>
        </mxCell>

        <!-- Data Format -->
        <mxCell id="data_box" value="数据格式" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="500" y="540" width="600" height="100" as="geometry"/>
        </mxCell>

        <mxCell id="data_content" value="输入: Bitmap (256 bits = 32B) + Packed 2-bit data (max 64B)&#xa;&#xa;输出: INT8 array (256 × 1B = 256B) + 非零计数 (u32)" style="text;html=1;align=left;verticalAlign=middle;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="520" y="575" width="560" height="55" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
